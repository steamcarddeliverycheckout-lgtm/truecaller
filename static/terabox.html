<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terabox Video</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #0b1220; color: #e5e7eb; }
    h1 { font-size: 20px; margin-bottom: 10px; color: #93c5fd; }
    input, button { padding: 10px; font-size: 14px; }
    input { width: 100%; max-width: 680px; margin-right: 8px; border-radius: 6px; border: 1px solid #1f2937; background: #0f172a; color: #e5e7eb; }
    button { background: #2563eb; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #1d4ed8; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .info { margin-top: 12px; font-size: 13px; color: #cbd5e1; }
    .thumb { margin-top: 8px; }
    video { width: 100%; max-width: 900px; margin-top: 16px; background: #000; border-radius: 8px; }
    .error { color: #fca5a5; margin-top: 8px; }
    .small { font-size: 12px; opacity: .8 }
  </style>
  <script>
    async function fetchInfo() {
      const url = document.getElementById('tb_url').value.trim();
      const out = document.getElementById('out');
      const err = document.getElementById('err');
      const titleEl = document.getElementById('title');
      const thumbEl = document.getElementById('thumb');
      const vid = document.getElementById('vid');
      err.textContent = '';
      out.textContent = 'Fetching info...';
      titleEl.textContent = '';
      thumbEl.innerHTML = '';
      vid.src = '';
      if (!url) { err.textContent = 'Enter Terabox link'; out.textContent=''; return; }

      try {
        const res = await fetch('/terabox/info?url=' + encodeURIComponent(url));
        const data = await res.json();
        if (!res.ok) { throw new Error((data && data.detail) || 'Failed'); }

        // Expect data like {"‚úÖ Status":"Success","üìú Extracted Info":[{ ... }],"üîó ShortLink":"..."}
        const list = data['üìú Extracted Info'] || data['üìÑ Extracted Info'] || data['Extracted Info'] || [];
        if (!Array.isArray(list) || list.length === 0) { throw new Error('No entries'); }
        const first = list[0];
        const direct = first['üîΩ Direct Download Link'] || first['Direct Download Link'] || first['download'] || '';
        const title = first['üìÇ Title'] || first['Title'] || 'Video';
        const thumbs = first['üñºÔ∏è Thumbnails'] || first['Thumbnails'] || {};

        titleEl.textContent = title;
        // pick a decent size thumb if present
        const thumbUrl = thumbs['360x270'] || thumbs['850x580'] || thumbs['140x90'] || thumbs['60x60'] || '';
        if (thumbUrl) thumbEl.innerHTML = '<img src="' + thumbUrl + '" alt="thumb">';

        if (!direct) { throw new Error('No direct link found'); }
        // Use proxy stream to avoid CORS issues
        const proxy = '/terabox/stream?direct=' + encodeURIComponent(direct);
        vid.src = proxy;
        vid.load();
        vid.play().catch(()=>{});
        out.textContent = 'Ready';
      } catch (e) {
        err.textContent = 'Error: ' + e.message;
        out.textContent = '';
      }
    }
  </script>
</head>
<body>
  <h1>Terabox Video (no UI framework)</h1>
  <div class="row">
    <input id="tb_url" placeholder="Paste Terabox link here">
    <button onclick="fetchInfo()">Get Video</button>
  </div>
  <div class="info" id="out"></div>
  <div class="error" id="err"></div>
  <div class="thumb" id="thumb"></div>
  <div class="small" id="title"></div>
  <video id="vid" controls playsinline></video>
</body>
</html>


